/*! @name videojs-contrib-ads @version 6.6.4 @license Apache-2.0 */
(function(n,t){typeof exports=="object"&&typeof module!="undefined"?module.exports=t(require("video.js"),require("global/window"),require("global/document")):typeof define=="function"&&define.amd?define(["video.js","global/window","global/document"],t):(n=n||self,n.videojsContribAds=t(n.videojs,n.window,n.document))})(this,function(n,t,i){"use strict";function yt(t){return{disableNextSnapshotRestore:!1,_contentEnding:!1,_contentHasEnded:!1,_hasThereBeenALoadStartDuringPlayerLife:!1,_hasThereBeenALoadedData:!1,_hasThereBeenALoadedMetaData:!1,_inLinearAdMode:!1,_shouldBlockPlay:!1,_playBlocked:!1,_playRequested:!1,adType:null,VERSION:l,reset:function(){t.ads.disableNextSnapshotRestore=!1;t.ads._contentEnding=!1;t.ads._contentHasEnded=!1;t.ads.snapshot=null;t.ads.adType=null;t.ads._hasThereBeenALoadedData=!1;t.ads._hasThereBeenALoadedMetaData=!1;t.ads._cancelledPlay=!1;t.ads._shouldBlockPlay=!1;t.ads._playBlocked=!1;t.ads.nopreroll_=!1;t.ads.nopostroll_=!1;t.ads._playRequested=!1},startLinearAdMode:function(){t.ads._state.startLinearAdMode()},endLinearAdMode:function(){t.ads._state.endLinearAdMode()},skipLinearAdMode:function(){t.ads._state.skipLinearAdMode()},stitchedAds:function(t){return t!==undefined&&(n.log.warn("Using player.ads.stitchedAds() as a setter is deprecated, it should be set as an option upon initialization of contrib-ads."),this.settings.stitchedAds=!!t),this.settings.stitchedAds},videoElementRecycled:function(){if(t.ads.shouldPlayContentBehindAd(t))return!1;if(!this.snapshot)throw new Error("You cannot use videoElementRecycled while there is no snapshot.");var n=t.tech_.src()!==this.snapshot.src,i=t.currentSrc()!==this.snapshot.currentSrc;return n||i},isLive:function(i){return(i===void 0&&(i=t),typeof i.ads.settings.contentIsLive=="boolean")?i.ads.settings.contentIsLive:i.duration()===Infinity||n.browser.IOS_VERSION==="8"&&i.duration()===0?!0:!1},shouldPlayContentBehindAd:function(i){if(i===void 0&&(i=t),i)return i.ads.settings.liveCuePoints?!n.browser.IS_IOS&&!n.browser.IS_ANDROID&&i.duration()===Infinity:!1;throw new Error("shouldPlayContentBehindAd requires a player as a param");},shouldTakeSnapshots:function(n){return n===void 0&&(n=t),!this.shouldPlayContentBehindAd(n)&&!this.stitchedAds()},isInAdMode:function(){return this._state.isAdState()},isWaitingForAdBreak:function(){return this._state.isWaitingForAdBreak()},isContentResuming:function(){return this._state.isContentResuming()},isAdPlaying:function(){return this._state.inAdBreak()},inAdBreak:function(){return this._state.inAdBreak()},removeNativePoster:function(){var n=t.$(".vjs-tech");n&&n.removeAttribute("poster")},debug:function(){if(this.settings.debug){for(var r=arguments.length,t=new Array(r),i=0;i<r;i++)t[i]=arguments[i];t.length===1&&typeof t[0]=="string"?n.log("ADS: "+t[0]):n.log.apply(n,["ADS:"].concat(t))}}}}function dt(n){n.type==="playing"?pt(this,n):n.type==="ended"?wt(this,n):n.type==="loadstart"||n.type==="loadeddata"||n.type==="loadedmetadata"?bt(this,n):n.type==="play"?kt(this,n):this.ads.isInAdMode()&&(this.ads.isContentResuming()?u(this,"content",n):u(this,"ad",n))}function gt(n){n.ads.contentSrc=n.currentSrc();n.ads._seenInitialLoadstart=!1;var t=function(){if(!n.ads.inAdBreak()){var t=n.currentSrc();t!==n.ads.contentSrc&&(n.ads._seenInitialLoadstart&&n.trigger({type:"contentchanged"}),n.trigger({type:"contentupdate",oldValue:n.ads.contentSrc,newValue:t}),n.ads.contentSrc=t);n.ads._seenInitialLoadstart=!0}};n.on("loadstart",t)}function ni(r,u,f){var s=this,o={},e,h,c;r=r.replace(/{([^}=]+)=([^}]+)}/g,function(n,t,i){return o["{"+t+"}"]=i,"{"+t+"}"});u===undefined&&(u=!1);e={};f!==undefined&&(e=f);e["{player.id}"]=this.options_["data-player"];e["{mediainfo.id}"]=this.mediainfo?this.mediainfo.id:"";e["{mediainfo.name}"]=this.mediainfo?this.mediainfo.name:"";e["{mediainfo.duration}"]=this.mediainfo?this.mediainfo.duration:"";e["{player.duration}"]=this.duration();e["{timestamp}"]=(new Date).getTime();e["{document.referrer}"]=i.referrer;e["{window.location.href}"]=t.location.href;e["{random}"]=Math.floor(Math.random()*1e12);["description","tags","reference_id","ad_keys"].forEach(function(n){e["{mediainfo."+n+"}"]=s.mediainfo&&s.mediainfo[n]?s.mediainfo[n]:o["{mediainfo."+n+"}"]?o["{mediainfo."+n+"}"]:""});v(this.mediainfo,e,"custom_fields");v(this.mediainfo,e,"customFields");for(h in e)r=r.split(h).join(a(e[h],u));r=r.replace(/{pageVariable\.([^}]+)}/g,function(i,r){for(var h,f,c=t,s=r.split("."),e=0;e<s.length;e++)e===s.length-1?f=c[s[e]]:c=c[s[e]];return(h=typeof f,f===null)?"null":f===undefined?o["{pageVariable."+r+"}"]?o["{pageVariable."+r+"}"]:(n.log.warn('Page variable "'+r+'" not found'),""):h!=="string"&&h!=="number"&&h!=="boolean"?(n.log.warn('Page variable "'+r+'" is not a supported type'),""):a(String(f),u)});for(c in o)r=r.replace(c,o[c]);return r}function ti(t,i){i&&n.log("Using cancelContentPlay to block content playback");t.on("play",ii)}function ii(){this.ads._shouldBlockPlay!==!1&&(this.paused()||(this.ads.debug("Playback was canceled by cancelContentPlay"),this.pause()),this.ads._cancelledPlay=!0)}function ei(t){if(fi(n))return!1;var i=n.registerPlugin||n.plugin;return i("ads",t),ui()&&!n.usingContribAdsMiddleware_&&(n.use("*",ri),n.usingContribAdsMiddleware_=!0,n.log.debug("Play middleware has been registered with videojs")),!0}function f(n,t){n.prototype=Object.create(t.prototype);n.prototype.constructor=n;n.__proto__=t}function oi(t){var f,i,r;f=n.browser.IS_IOS&&t.ads.isLive(t)?t.seekable().length>0?t.currentTime()-t.seekable().end(0):t.currentTime():t.currentTime();var e=t.$(".vjs-tech"),o=t.textTracks?t.textTracks():[],s=[],u={ended:t.ended(),currentSrc:t.currentSrc(),sources:t.currentSources(),src:t.tech_.src(),currentTime:f,type:t.currentType()};for(e&&(u.style=e.getAttribute("style")),i=0;i<o.length;i++)r=o[i],s.push({track:r,mode:r.mode}),r.mode="disabled";return u.suppressedTracks=s,u}function si(t,i){var r=t.ads.snapshot,o;if(i===undefined&&(i=function(){}),t.ads.disableNextSnapshotRestore===!0){t.ads.disableNextSnapshotRestore=!1;delete t.ads.snapshot;i();return}var u=t.$(".vjs-tech"),l=20,h=r.suppressedTracks,s,c=function(){for(var n=0;n<h.length;n++)s=h[n],s.track.mode=s.mode},f=function(){var f,i,u;n.browser.IS_IOS&&t.ads.isLive(t)?(r.currentTime<0&&(f=t.seekable().length>0?t.seekable().end(0)+r.currentTime:t.currentTime(),t.currentTime(f)),t.paused()&&(i=t.play(),i&&i.catch&&i.catch(function(t){n.log.warn("Play promise rejected in IOS snapshot resume",t)}))):r.ended?t.currentTime(t.duration()):(t.currentTime(r.currentTime),u=t.play(),u&&u.catch&&u.catch(function(t){n.log.warn("Play promise rejected in snapshot resume",t)}));t.ads.shouldRemoveAutoplay_&&(t.autoplay(!1),t.ads.shouldRemoveAutoplay_=!1)},e=function e(){if((t.off("contentcanplay",e),y&&t.clearTimeout(y),u=t.el().querySelector(".vjs-tech"),u.readyState>1)||u.seekable===undefined||u.seekable.length>0)return f();if(l--)t.setTimeout(e,50);else try{f()}catch(i){n.log.warn("Failed to resume the content after an advertisement",i)}};if("style"in r&&u.setAttribute("style",r.style||""),t.ads.videoElementRecycled()){t.one("resumeended",function(){delete t.ads.snapshot;i()});t.one("contentloadedmetadata",c);n.browser.IS_IOS&&!t.autoplay()&&(t.autoplay(!0),t.ads.shouldRemoveAutoplay_=!0);t.src(r.sources);t.one("contentcanplay",e);y=t.setTimeout(e,2e3)}else c(),t.ended()||(o=t.play(),o&&o.catch&&o.catch(function(t){n.log.warn("Play promise rejected in snapshot restore",t)})),delete t.ads.snapshot,i()}function hi(n){n.ads.debug("Starting ad break");n.ads._inLinearAdMode=!0;n.trigger("adstart");n.ads.shouldTakeSnapshots()&&(n.ads.snapshot=oi(n));n.ads.shouldPlayContentBehindAd(n)&&(n.ads.preAdVolume_=n.volume(),n.volume(0));n.addClass("vjs-ad-playing");n.hasClass("vjs-live")&&n.removeClass("vjs-live");n.ads.removeNativePoster()}function ci(n,t){n.ads.debug("Ending ad break");t===undefined&&(t=function(){});n.ads.adType=null;n.ads._inLinearAdMode=!1;n.trigger("adend");n.removeClass("vjs-ad-playing");n.ads.isLive(n)&&n.addClass("vjs-live");n.ads.shouldTakeSnapshots()?si(n,t):(n.volume(n.ads.preAdVolume_),t())}var l,a,v,e,b,k,h,o,r,c,d,g,nt,tt,y,it,rt,ut,ft,et,ot,st,ht,ct,lt,at,vt;n=n&&n.hasOwnProperty("default")?n["default"]:n;t=t&&t.hasOwnProperty("default")?t["default"]:t;i=i&&i.hasOwnProperty("default")?i["default"]:i;l="6.6.4";var w=function(n,t){t.isImmediatePropagationStopped=function(){return!0};t.cancelBubble=!0;t.isPropagationStopped=function(){return!0}},u=function(n,t,i){w(n,i);n.trigger({type:t+i.type,originalEvent:i})},pt=function(n,t){n.ads.isInAdMode()&&(n.ads.isContentResuming()?n.ads._contentEnding&&u(n,"content",t):u(n,"ad",t))},wt=function(n,t){n.ads.isInAdMode()?n.ads.isContentResuming()?(w(n,t),n.trigger("resumeended")):u(n,"ad",t):n.ads._contentHasEnded||n.ads.stitchedAds()||(u(n,"content",t),n.trigger("readyforpostroll"))},bt=function(n,t){if((t.type!=="loadstart"||n.ads._hasThereBeenALoadStartDuringPlayerLife)&&(t.type!=="loadeddata"||n.ads._hasThereBeenALoadedData)&&(t.type!=="loadedmetadata"||n.ads._hasThereBeenALoadedMetaData))if(n.ads.inAdBreak())u(n,"ad",t);else{if(n.currentSrc()!==n.ads.contentSrc)return;u(n,"content",t)}else return},kt=function(n,t){n.ads.inAdBreak()?u(n,"ad",t):n.ads.isContentResuming()&&u(n,"content",t)};a=function(n,t){return t?encodeURIComponent(n):n};v=function(n,t,i){var f,u,r,e;if(n&&n[i])for(f=n[i],u=Object.keys(f),r=0;r<u.length;r++)e="{mediainfo."+i+"."+u[r]+"}",t[e]=f[u[r]]};e={};e.processMetadataTracks=function(n,t){for(var i=n.textTracks(),u=function(i){i.kind==="metadata"&&(n.ads.cueTextTracks.setMetadataTrackMode(i),t(n,i))},r=0;r<i.length;r++)u(i[r]);i.addEventListener("addtrack",function(n){u(n.track)})};e.setMetadataTrackMode=function(){return};e.getSupportedAdCue=function(n,t){return t};e.isSupportedAdCue=function(){return!0};e.getCueId=function(n,t){return t.id};b=function(n,t){return t!==undefined&&n.ads.includedCues[t]};k=function(n,t){t!==undefined&&t!==""&&(n.ads.includedCues[t]=!0)};e.processAdTrack=function(t,i,r,u){var o,f,s,e,h;for(t.ads.includedCues={},o=0;o<i.length;o++){if(f=i[o],s=this.getSupportedAdCue(t,f),!this.isSupportedAdCue(t,f)){n.log.warn("Skipping as this is not a supported ad cue.",f);return}if(e=this.getCueId(t,f),h=f.startTime,b(t,e)){n.log("Skipping ad already seen with ID "+e);return}u&&u(t,s,e,h);r(t,s,e,h);k(t,e)}};h={};o=n;h.isMiddlewareMediatorSupported=function(){return o.browser.IS_IOS||o.browser.IS_ANDROID?!1:o.use&&o.middleware&&o.middleware.TERMINATOR?!0:!1};h.playMiddleware=function(t){return{setSource:function(n,t){t(null,n)},callPlay:function(){if(t.ads&&t.ads._shouldBlockPlay===!0)return t.ads.debug("Using playMiddleware to block content playback"),t.ads._playBlocked=!0,o.middleware.TERMINATOR},play:function(i,r){t.ads&&t.ads._playBlocked&&i?(t.ads.debug("Play call to Tech was terminated."),t.trigger("play"),t.addClass("vjs-has-started"),t.ads._playBlocked=!1):r&&r.catch&&r.catch(function(i){i.name!=="NotAllowedError"||n.browser.IS_SAFARI||t.trigger("pause")})}}};h.testHook=function(n){o=n};var ri=h.playMiddleware,ui=h.isMiddlewareMediatorSupported,fi=function(){if(n.getPlugin)return Boolean(n.getPlugin("ads"));var t=n.getComponent("Player");return Boolean(t&&t.prototype.ads)};r=function(){function n(){}return n.getState=function(t){if(t)return n.states_&&n.states_[t]?n.states_[t]:void 0},n.registerState=function(t,i){if(typeof t!="string"||!t)throw new Error('Illegal state name, "'+t+'"; must be a non-empty string.');return n.states_||(n.states_={}),n.states_[t]=i,i},n}();c=function(){function i(n){this.player=n}i._getName=function(){return"Anonymous State"};var t=i.prototype;return t.transitionTo=function(n){var t=this.player,i;this.cleanup(t);i=new n(t);t.ads._state=i;t.ads.debug(this.constructor._getName()+" -> "+i.constructor._getName());for(var u=arguments.length,f=new Array(u>1?u-1:0),r=1;r<u;r++)f[r-1]=arguments[r];i.init.apply(i,[t].concat(f))},t.init=function(){},t.cleanup=function(){},t.onPlay=function(){},t.onPlaying=function(){},t.onEnded=function(){},t.onAdEnded=function(){},t.onAdsReady=function(){n.log.warn("Unexpected adsready event")},t.onAdsError=function(){},t.onAdsCanceled=function(){},t.onAdTimeout=function(){},t.onAdStarted=function(){},t.onContentChanged=function(){},t.onContentResumed=function(){},t.onReadyForPostroll=function(){n.log.warn("Unexpected readyforpostroll event")},t.onNoPreroll=function(){},t.onNoPostroll=function(){},t.startLinearAdMode=function(){n.log.warn("Unexpected startLinearAdMode invocation (State via "+this.constructor._getName()+")")},t.endLinearAdMode=function(){n.log.warn("Unexpected endLinearAdMode invocation (State via "+this.constructor._getName()+")")},t.skipLinearAdMode=function(){n.log.warn("Unexpected skipLinearAdMode invocation (State via "+this.constructor._getName()+")")},t.isAdState=function(){throw new Error("isAdState unimplemented for "+this.constructor._getName());},t.isWaitingForAdBreak=function(){return!1},t.isContentResuming=function(){return!1},t.inAdBreak=function(){return!1},t.handleEvent=function(n){var t=this.player;if(n==="play")this.onPlay(t);else if(n==="adsready")this.onAdsReady(t);else if(n==="adserror")this.onAdsError(t);else if(n==="adscanceled")this.onAdsCanceled(t);else if(n==="adtimeout")this.onAdTimeout(t);else if(n==="ads-ad-started")this.onAdStarted(t);else if(n==="contentchanged")this.onContentChanged(t);else if(n==="contentresumed")this.onContentResumed(t);else if(n==="readyforpostroll")this.onReadyForPostroll(t);else if(n==="playing")this.onPlaying(t);else if(n==="ended")this.onEnded(t);else if(n==="nopreroll")this.onNoPreroll(t);else if(n==="nopostroll")this.onNoPostroll(t);else if(n==="adended")this.onAdEnded(t)},i}();r.registerState("State",c);d=function(n){function i(t){var i;return i=n.call(this,t)||this,i.contentResuming=!1,i.waitingForAdBreak=!1,i}f(i,n);var t=i.prototype;return t.isAdState=function(){return!0},t.onPlaying=function(){var n=r.getState("ContentPlayback");this.contentResuming&&this.transitionTo(n)},t.onContentResumed=function(){var n=r.getState("ContentPlayback");this.contentResuming&&this.transitionTo(n)},t.isWaitingForAdBreak=function(){return this.waitingForAdBreak},t.isContentResuming=function(){return this.contentResuming},t.inAdBreak=function(){return this.player.ads._inLinearAdMode===!0},i}(c);r.registerState("AdState",d);g=function(n){function t(){return n.apply(this,arguments)||this}f(t,n);var i=t.prototype;return i.isAdState=function(){return!1},i.onContentChanged=function(n){var t=r.getState("BeforePreroll"),i=r.getState("Preroll");n.ads.debug("Received contentchanged event (ContentState)");n.paused()?this.transitionTo(t):(this.transitionTo(i,!1),n.pause(),n.ads._pausedOnContentupdate=!0)},t}(c);r.registerState("ContentState",g);nt=r.getState("ContentState");tt=function(t){function i(){return t.apply(this,arguments)||this}f(i,t);i._getName=function(){return"AdsDone"};var r=i.prototype;return r.init=function(n){n.ads._contentHasEnded=!0;n.trigger("ended")},r.startLinearAdMode=function(){n.log.warn("Unexpected startLinearAdMode invocation (AdsDone)")},i}(nt);r.registerState("AdsDone",tt);var s={start:hi,end:ci},li=r.getState("AdState"),ai=function(t){function r(){return t.apply(this,arguments)||this}f(r,t);r._getName=function(){return"Preroll"};var i=r.prototype;return i.init=function(n,t,i){if(this.waitingForAdBreak=!0,n.addClass("vjs-ad-loading"),i||n.ads.nopreroll_)return this.resumeAfterNoPreroll(n);var r=n.ads.settings.timeout;typeof n.ads.settings.prerollTimeout=="number"&&(r=n.ads.settings.prerollTimeout);this._timeout=n.setTimeout(function(){n.trigger("adtimeout")},r);t?this.handleAdsReady():this.adsReady=!1},i.onAdsReady=function(t){t.ads.inAdBreak()?n.log.warn("Unexpected adsready event (Preroll)"):(t.ads.debug("Received adsready event (Preroll)"),this.handleAdsReady())},i.handleAdsReady=function(){this.adsReady=!0;this.readyForPreroll()},i.afterLoadStart=function(n){var t=this.player;if(t.ads._hasThereBeenALoadStartDuringPlayerLife)n();else{t.ads.debug("Waiting for loadstart...");t.one("loadstart",function(){t.ads.debug("Received loadstart event");n()})}},i.noPreroll=function(){var n=this;this.afterLoadStart(function(){n.player.ads.debug("Skipping prerolls due to nopreroll event (Preroll)");n.resumeAfterNoPreroll(n.player)})},i.readyForPreroll=function(){var n=this.player;this.afterLoadStart(function(){n.ads.debug("Triggered readyforpreroll event (Preroll)");n.trigger("readyforpreroll")})},i.onAdsCanceled=function(n){var t=this;n.ads.debug("adscanceled (Preroll)");this.afterLoadStart(function(){t.resumeAfterNoPreroll(n)})},i.onAdsError=function(t){var i=this;n.log("adserror (Preroll)");this.inAdBreak()?t.ads.endLinearAdMode():this.afterLoadStart(function(){i.resumeAfterNoPreroll(t)})},i.startLinearAdMode=function(){var t=this.player;!this.adsReady||t.ads.inAdBreak()||this.isContentResuming()?n.log.warn("Unexpected startLinearAdMode invocation (Preroll)"):(this.clearTimeout(t),t.ads.adType="preroll",this.waitingForAdBreak=!1,s.start(t),t.ads._shouldBlockPlay=!1)},i.onAdStarted=function(n){n.removeClass("vjs-ad-loading")},i.endLinearAdMode=function(){var n=this.player;this.inAdBreak()&&(n.removeClass("vjs-ad-loading"),n.addClass("vjs-ad-content-resuming"),this.contentResuming=!0,s.end(n))},i.skipLinearAdMode=function(){var i=this,t=this.player;t.ads.inAdBreak()||this.isContentResuming()?n.log.warn("Unexpected skipLinearAdMode invocation"):this.afterLoadStart(function(){t.trigger("adskip");t.ads.debug("skipLinearAdMode (Preroll)");i.resumeAfterNoPreroll(t)})},i.onAdTimeout=function(n){var t=this;this.afterLoadStart(function(){n.ads.debug("adtimeout (Preroll)");t.resumeAfterNoPreroll(n)})},i.onNoPreroll=function(t){t.ads.inAdBreak()||this.isContentResuming()?n.log.warn("Unexpected nopreroll event (Preroll)"):this.noPreroll()},i.resumeAfterNoPreroll=function(n){if(this.contentResuming=!0,n.ads._shouldBlockPlay=!1,this.cleanupPartial(n),n.paused()&&(n.ads._playRequested||n.ads._pausedOnContentupdate)){var t=n.play();t&&t.then&&t.then(null,function(){})}},i.cleanup=function(t){t.ads._hasThereBeenALoadStartDuringPlayerLife||n.log.warn("Leaving Preroll state before loadstart event can cause issues.");this.cleanupPartial(t)},i.cleanupPartial=function(n){n.removeClass("vjs-ad-loading");n.removeClass("vjs-ad-content-resuming");this.clearTimeout(n)},i.clearTimeout=function(n){n.clearTimeout(this._timeout);this._timeout=null},r}(li);r.registerState("Preroll",ai);it=r.getState("ContentState");rt=function(n){function i(){return n.apply(this,arguments)||this}f(i,n);i._getName=function(){return"BeforePreroll"};var t=i.prototype;return t.init=function(n){this.adsReady=!1;this.shouldResumeToContent=!1;n.ads._shouldBlockPlay=!0},t.onAdsReady=function(n){n.ads.debug("Received adsready event (BeforePreroll)");this.adsReady=!0},t.onPlay=function(n){var t=r.getState("Preroll");n.ads.debug("Received play event (BeforePreroll)");this.transitionTo(t,this.adsReady,this.shouldResumeToContent)},t.onAdsCanceled=function(n){n.ads.debug("adscanceled (BeforePreroll)");this.shouldResumeToContent=!0},t.onAdsError=function(){this.player.ads.debug("adserror (BeforePreroll)");this.shouldResumeToContent=!0},t.onNoPreroll=function(){this.player.ads.debug("Skipping prerolls due to nopreroll event (BeforePreroll)");this.shouldResumeToContent=!0},t.skipLinearAdMode=function(){var n=this.player;n.trigger("adskip");n.ads.debug("skipLinearAdMode (BeforePreroll)");this.shouldResumeToContent=!0},t.onContentChanged=function(){this.init(this.player)},i}(it);r.registerState("BeforePreroll",rt);ut=r.getState("AdState");ft=function(n){function i(){return n.apply(this,arguments)||this}f(i,n);i._getName=function(){return"Midroll"};var t=i.prototype;return t.init=function(n){n.ads.adType="midroll";s.start(n);n.addClass("vjs-ad-loading")},t.onAdStarted=function(n){n.removeClass("vjs-ad-loading")},t.endLinearAdMode=function(){var n=this.player;this.inAdBreak()&&(this.contentResuming=!0,n.addClass("vjs-ad-content-resuming"),n.removeClass("vjs-ad-loading"),s.end(n))},t.onAdsError=function(n){this.inAdBreak()&&n.ads.endLinearAdMode()},t.cleanup=function(n){n.removeClass("vjs-ad-loading");n.removeClass("vjs-ad-content-resuming")},i}(ut);r.registerState("Midroll",ft);et=r.getState("AdState");ot=function(t){function u(){return t.apply(this,arguments)||this}f(u,t);u._getName=function(){return"Postroll"};var i=u.prototype;return i.init=function(n){var t,i;this.waitingForAdBreak=!0;n.ads._contentEnding=!0;n.ads.nopostroll_?(this.resumeContent(n),i=r.getState("AdsDone"),this.transitionTo(i)):(n.addClass("vjs-ad-loading"),t=n.ads.settings.timeout,typeof n.ads.settings.postrollTimeout=="number"&&(t=n.ads.settings.postrollTimeout),this._postrollTimeout=n.setTimeout(function(){n.trigger("adtimeout")},t))},i.startLinearAdMode=function(){var t=this.player;t.ads.inAdBreak()||this.isContentResuming()?n.log.warn("Unexpected startLinearAdMode invocation (Postroll)"):(t.ads.adType="postroll",t.clearTimeout(this._postrollTimeout),this.waitingForAdBreak=!1,s.start(t))},i.onAdStarted=function(n){n.removeClass("vjs-ad-loading")},i.endLinearAdMode=function(){var t=this,n=this.player,i=r.getState("AdsDone");this.inAdBreak()&&(n.removeClass("vjs-ad-loading"),this.resumeContent(n),s.end(n,function(){t.transitionTo(i)}))},i.skipLinearAdMode=function(){var t=this.player;t.ads.inAdBreak()||this.isContentResuming()?n.log.warn("Unexpected skipLinearAdMode invocation"):(t.ads.debug("Postroll abort (skipLinearAdMode)"),t.trigger("adskip"),this.abort(t))},i.onAdTimeout=function(n){n.ads.debug("Postroll abort (adtimeout)");this.abort(n)},i.onAdsError=function(n){n.ads.debug("Postroll abort (adserror)");n.ads.inAdBreak()?n.ads.endLinearAdMode():this.abort(n)},i.onContentChanged=function(){var n,t;this.isContentResuming()?(n=r.getState("BeforePreroll"),this.transitionTo(n)):this.inAdBreak()||(t=r.getState("Preroll"),this.transitionTo(t))},i.onNoPostroll=function(t){this.isContentResuming()||this.inAdBreak()?n.log.warn("Unexpected nopostroll event (Postroll)"):this.abort(t)},i.resumeContent=function(n){this.contentResuming=!0;n.addClass("vjs-ad-content-resuming")},i.abort=function(n){var t=r.getState("AdsDone");this.resumeContent(n);n.removeClass("vjs-ad-loading");this.transitionTo(t)},i.cleanup=function(n){n.removeClass("vjs-ad-content-resuming");n.clearTimeout(this._postrollTimeout);n.ads._contentEnding=!1},u}(et);r.registerState("Postroll",ot);st=r.getState("ContentState");ht=function(n){function t(){return n.apply(this,arguments)||this}f(t,n);t._getName=function(){return"ContentPlayback"};var i=t.prototype;return i.init=function(n){n.ads._shouldBlockPlay=!1},i.onAdsReady=function(n){n.ads.debug("Received adsready event (ContentPlayback)");n.ads.nopreroll_||(n.ads.debug("Triggered readyforpreroll event (ContentPlayback)"),n.trigger("readyforpreroll"))},i.onReadyForPostroll=function(n){var t=r.getState("Postroll");n.ads.debug("Received readyforpostroll event");this.transitionTo(t)},i.startLinearAdMode=function(){var n=r.getState("Midroll");this.transitionTo(n)},t}(st);r.registerState("ContentPlayback",ht);ct=r.getState("ContentState");lt=function(n){function t(){return n.apply(this,arguments)||this}f(t,n);t._getName=function(){return"StitchedContentPlayback"};var i=t.prototype;return i.init=function(){this.player.ads._shouldBlockPlay=!1},i.onContentChanged=function(){this.player.ads.debug("Received contentchanged event ("+this._getName()+")")},i.startLinearAdMode=function(){var n=r.getState("StitchedAdRoll");this.transitionTo(n)},t}(ct);r.registerState("StitchedContentPlayback",lt);at=r.getState("AdState");vt=function(n){function i(){return n.apply(this,arguments)||this}f(i,n);i._getName=function(){return"StitchedAdRoll"};var t=i.prototype;return t.init=function(){this.waitingForAdBreak=!1;this.contentResuming=!1;this.player.ads.adType="stitched";s.start(this.player)},t.onPlaying=function(){},t.onContentResumed=function(){},t.onAdEnded=function(){this.endLinearAdMode();this.player.trigger("ended")},t.endLinearAdMode=function(){var n=r.getState("StitchedContentPlayback");s.end(this.player);this.transitionTo(n)},i}(at);r.registerState("StitchedAdRoll",vt);var vi=h.isMiddlewareMediatorSupported,yi=n.getTech("Html5").Events,pi={timeout:5e3,prerollTimeout:undefined,postrollTimeout:undefined,debug:!1,stitchedAds:!1,contentIsLive:undefined,liveCuePoints:!0},p=function(t){var i=this,u=n.mergeOptions(pi,t),f=[],s,o;yi.concat(["firstplay","loadedalldata"]).forEach(function(n){f.indexOf(n)===-1&&f.push(n)});i.on(f,dt);vi()||ti(i,u.debug);i.setTimeout(function(){i.ads._hasThereBeenALoadStartDuringPlayerLife||i.src()===""||n.log.error("videojs-contrib-ads has not seen a loadstart event 5 seconds after being initialized, but a source is present. This indicates that videojs-contrib-ads was initialized too late. It must be initialized immediately after video.js in the same tick. As a result, some ads will not play and some media events will be incorrect. For more information, see http://videojs.github.io/videojs-contrib-ads/integrator/getting-started.html")},5e3);i.on("ended",function(){i.hasClass("vjs-has-started")||i.addClass("vjs-has-started")});i.on("contenttimeupdate",function(){i.removeClass("vjs-waiting")});i.on(["addurationchange","adcanplay"],function(){if(!i.ads.settings.stitchedAds&&!i.hasStarted()&&(!i.ads.snapshot||i.currentSrc()!==i.ads.snapshot.currentSrc)&&i.ads.inAdBreak()){var t=i.play();t&&t.catch&&t.catch(function(t){n.log.warn("Play promise rejected when playing ad",t)})}});i.on("nopreroll",function(){i.ads.debug("Received nopreroll event");i.ads.nopreroll_=!0});i.on("nopostroll",function(){i.ads.debug("Received nopostroll event");i.ads.nopostroll_=!0});i.on("playing",function(){i.ads._cancelledPlay=!1;i.ads._pausedOnContentupdate=!1});i.on("play",function(){i.ads._playRequested=!0});i.one("loadstart",function(){i.ads._hasThereBeenALoadStartDuringPlayerLife=!0});i.on("loadeddata",function(){i.ads._hasThereBeenALoadedData=!0});i.on("loadedmetadata",function(){i.ads._hasThereBeenALoadedMetaData=!0});i.ads=yt(i);i.ads.settings=u;u.stitchedAds=!!u.stitchedAds;i.ads._state=u.stitchedAds?new(r.getState("StitchedContentPlayback"))(i):new(r.getState("BeforePreroll"))(i);i.ads._state.init(i);i.ads.cueTextTracks=e;i.ads.adMacroReplacement=ni.bind(i);gt(i);i.on("contentchanged",i.ads.reset);s=function(){return!i.ads.shouldPlayContentBehindAd(i)&&i.ads.inAdBreak()&&i.tech_.featuresNativeTextTracks&&n.browser.IS_IOS&&!Array.isArray(i.textTracks())};o=function(){var r=i.textTracks(),n,t;if(s())for(n=0;n<r.length;n++)t=r[n],t.mode==="showing"&&(t.mode="disabled")};i.ready(function(){i.textTracks().addEventListener("change",o)});i.on(["play","playing","ended","adsready","adscanceled","adskip","adserror","adtimeout","adended","ads-ad-started","contentchanged","dispose","contentresumed","readyforpostroll","nopreroll","nopostroll"],function(n){i.ads._state.handleEvent(n.type)});i.on("dispose",function(){i.ads.reset();i.textTracks().removeEventListener("change",o)})};return p.VERSION=l,ei(p),p});